<!DOCTYPE html>
<html>
<head>
    <title>踏频指示器</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        .container {
            text-align: center;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            max-width: 600px;
            width: 90%;
        }
        .indicators {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            gap: 20px;
        }
        .foot-indicator {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: #666;
            background-color: #ddd;
            transition: background-color 0.1s;
        }
        .active {
            background-color: #ff4444;
            color: white;
        }
        .controls {
            margin: 20px 0;
        }
        .presets {
            margin: 15px 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }
        .preset-btn {
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid #4CAF50;
            background-color: white;
            color: #4CAF50;
            cursor: pointer;
            transition: all 0.3s;
        }
        .preset-btn:hover {
            background-color: #4CAF50;
            color: white;
        }
        .preset-btn.active {
            background-color: #4CAF50;
            color: white;
        }
        button {
            padding: 10px 20px;
            margin: 0 5px;
            font-size: 16px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        input {
            font-size: 16px;
            padding: 5px;
            width: 60px;
            text-align: center;
        }
        .info {
            margin: 10px 0;
            font-size: 14px;
            color: #666;
        }
        .timer {
            font-size: 24px;
            font-weight: bold;
            margin: 15px 0;
            color: #333;
        }
        .timer-controls {
            margin: 10px 0;
        }
        .timer-controls button {
            background-color: #2196F3;
        }
        .timer-controls button:hover {
            background-color: #1976D2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>踏频指示器</h1>
        
        <!-- 计时器显示 -->
        <div id="timer" class="timer">00:00:00</div>
        <div class="timer-controls">
            <button id="timerToggle">开始计时</button>
            <button id="timerReset">重置计时</button>
        </div>

        <div class="indicators">
            <div id="leftFoot" class="foot-indicator">左</div>
            <div id="rightFoot" class="foot-indicator">右</div>
        </div>

        <!-- 预设RPM按钮 -->
        <div class="presets">
            <button class="preset-btn" data-rpm="60">60</button>
            <button class="preset-btn" data-rpm="75">75</button>
            <button class="preset-btn" data-rpm="90">90</button>
            <button class="preset-btn" data-rpm="100">100</button>
            <button class="preset-btn" data-rpm="120">120</button>
        </div>

        <div class="controls">
            <label>RPM: </label>
            <input type="number" id="rpmInput" value="90" min="1" max="999">
            <button id="startStop">开始</button>
        </div>
        <div id="currentRpm" class="info">当前踏频: 90 RPM (每分钟转数)</div>
    </div>

    <script>
        const leftFoot = document.getElementById('leftFoot');
        const rightFoot = document.getElementById('rightFoot');
        const rpmInput = document.getElementById('rpmInput');
        const startStopButton = document.getElementById('startStop');
        const currentRpm = document.getElementById('currentRpm');
        const presetButtons = document.querySelectorAll('.preset-btn');
        const timer = document.getElementById('timer');
        const timerToggle = document.getElementById('timerToggle');
        const timerReset = document.getElementById('timerReset');
        
        let isPlaying = false;
        let interval;
        let isLeftFoot = true;
        let timerInterval;
        let timerSeconds = 0;
        let isTimerRunning = false;
        
        // 创建音频上下文和音频节点
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        function formatTime(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = seconds % 60;
            return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timerSeconds++;
                timer.textContent = formatTime(timerSeconds);
            }, 1000);
            timerToggle.textContent = '暂停计时';
            isTimerRunning = true;
        }

        function pauseTimer() {
            clearInterval(timerInterval);
            timerToggle.textContent = '继续计时';
            isTimerRunning = false;
        }

        function resetTimer() {
            clearInterval(timerInterval);
            timerSeconds = 0;
            timer.textContent = formatTime(timerSeconds);
            timerToggle.textContent = '开始计时';
            isTimerRunning = false;
        }
        
        function createClickSound(isLeft) {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = isLeft ? 800 : 1000;
            gainNode.gain.value = 0.1;
            
            oscillator.start();
            gainNode.gain.exponentialRampToValueAtTime(0.00001, audioContext.currentTime + 0.1);
            
            setTimeout(() => {
                oscillator.stop();
                oscillator.disconnect();
                gainNode.disconnect();
            }, 100);
        }
        
        function startMetronome() {
            const rpm = parseInt(rpmInput.value);
            const intervalTime = (60 / rpm / 2) * 1000;
            
            interval = setInterval(() => {
                if (isLeftFoot) {
                    leftFoot.classList.add('active');
                    rightFoot.classList.remove('active');
                    createClickSound(true);
                } else {
                    rightFoot.classList.add('active');
                    leftFoot.classList.remove('active');
                    createClickSound(false);
                }
                
                isLeftFoot = !isLeftFoot;
                
                setTimeout(() => {
                    if (isLeftFoot) {
                        rightFoot.classList.remove('active');
                    } else {
                        leftFoot.classList.remove('active');
                    }
                }, intervalTime / 2);
            }, intervalTime);
        }
        
        function stopMetronome() {
            clearInterval(interval);
            leftFoot.classList.remove('active');
            rightFoot.classList.remove('active');
        }

        function updateActivePreset(rpm) {
            presetButtons.forEach(btn => {
                if (parseInt(btn.dataset.rpm) === rpm) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }
        
        startStopButton.addEventListener('click', () => {
            if (!isPlaying) {
                startMetronome();
                startStopButton.textContent = '停止';
                isPlaying = true;
                if (!isTimerRunning) {
                    startTimer();
                }
            } else {
                stopMetronome();
                startStopButton.textContent = '开始';
                isPlaying = false;
                pauseTimer();
            }
        });
        
        rpmInput.addEventListener('change', () => {
            let rpm = parseInt(rpmInput.value);
            
            rpmInput.value = rpm;
            currentRpm.textContent = `当前踏频: ${rpm} RPM (每分钟转数)`;
            updateActivePreset(rpm);
            
            if (isPlaying) {
                stopMetronome();
                startMetronome();
            }

        });

        // 预设按钮事件监听
        presetButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const rpm = parseInt(btn.dataset.rpm);
                rpmInput.value = rpm;
                currentRpm.textContent = `当前踏频: ${rpm} RPM (每分钟转数)`;
                updateActivePreset(rpm);

                if (!isTimerRunning) {
                    startTimer();
                }

                if (isPlaying) {
                    stopMetronome();
                    startMetronome();
                }else{
                    startMetronome();
                    startStopButton.textContent = '停止';
                    isPlaying = true;
                }
            });
        });

        // 计时器控制
        timerToggle.addEventListener('click', () => {
            if (!isTimerRunning) {
                startTimer();
            } else {
                pauseTimer();
            }
        });

        timerReset.addEventListener('click', resetTimer);
    </script>
</body>
</html>